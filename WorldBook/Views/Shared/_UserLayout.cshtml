<!DOCTYPE html>
<html lang="en">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - WorldBook</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/UserViews/ChatAI/chatbot.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/UserViews/Header/header.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/WorldBook.styles.css" asp-append-version="true" />
</head>
<body>
    <header class="modern-header sticky-top shadow-sm">
        <div class="container-fluid px-4">
            <nav class="navbar navbar-expand-lg navbar-dark py-3">
                <!-- Logo -->
                <a class="navbar-brand d-flex align-items-center" href="@Url.Action("GetBookHomePage", "Book")">
                    <i class="bi bi-book-fill fs-3 me-2 text-warning"></i>
                    <span class="fw-bold fs-4">WorldBook</span>
                </a>

                <!-- Mobile Toggle -->
                <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse"
                        data-bs-target="#mainNavbar" aria-controls="mainNavbar"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Navigation Content -->
                <div class="collapse navbar-collapse" id="mainNavbar">
                    <!-- Advanced Search Bar -->
                    <div class="search-container mx-auto my-3 my-lg-0">
                        <form action="@Url.Action("Index", "Search")" method="get" class="search-form">
                            <div class="input-group">
                                <input type="text"
                                       class="form-control search-input"
                                       name="query"
                                       id="searchInput"
                                       placeholder="Search books, authors, categories..."
                                       autocomplete="off"
                                       required />

                                <select name="filter" class="form-select filter-select" id="searchFilter">
                                    <option value="all">All</option>
                                    <option value="bookname">Book Name</option>
                                    <option value="author">Author</option>
                                    <option value="category">Category</option>
                                    <option value="publisher">Publisher</option>
                                </select>

                                <button class="btn btn-search" type="submit">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>

                            <!-- Search Suggestions Dropdown -->
                            <div class="search-suggestions" id="searchSuggestions"></div>
                        </form>
                    </div>

                    <!-- Right Side: Cart & Profile -->
                    <div class="d-flex align-items-center gap-3 ms-lg-3 mt-3 mt-lg-0">
                        @if (User.Identity?.IsAuthenticated ?? false)
                        {
                            <!-- Cart Icon with Badge -->
                            <a href="@Url.Action("Index", "Cart")"
                               class="nav-icon-link position-relative"
                               title="Shopping Cart">
                                <i class="bi bi-cart3 fs-4"></i>
                                <span class="cart-badge" id="cartBadge">0</span>
                            </a>

                            <!-- User Profile Dropdown -->
                            <div class="dropdown">
                                <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle"
                                   data-bs-toggle="dropdown" aria-expanded="false">
                                    <div class="user-avatar me-2">
                                        <i class="bi bi-person-circle fs-4"></i>
                                    </div>
                                    <span class="d-none d-lg-inline">@User.Identity?.Name</span>
                                </a>

                                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark shadow">
                                    <li>
                                        <a class="dropdown-item" href="@Url.Action("Profile", "User")">
                                            <i class="bi bi-person me-2"></i> Profile
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="@Url.Action("OrderHistory", "Order")">
                                            <i class="bi bi-clock-history me-2"></i> Orders
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="@Url.Action("UserFeedbackList", "Feedback")">
                                            <i class="bi bi-chat-left-text me-2"></i> My Feedbacks
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item text-danger" href="@Url.Action("Logout", "Logins")">
                                            <i class="bi bi-box-arrow-right me-2"></i> Sign out
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        }
                        else
                        {
                            <a href="@Url.Action("Login", "Logins")" class="btn btn-outline-light btn-sm px-4">
                                <i class="bi bi-box-arrow-in-right me-1"></i> Sign in
                            </a>
                        }
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <div class="container-fluid px-4">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <footer class="modern-footer mt-5 py-4 bg-dark text-white">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5><i class="bi bi-book-fill text-warning"></i> WorldBook</h5>
                    <p class="text-muted">Your trusted online bookstore</p>
                </div>
                <div class="col-md-4 mb-3">
                    <h6>Quick Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="@Url.Action("GetBookHomePage", "Book")" class="text-muted">Home</a></li>
                        <li><a href="#" class="text-muted">About Us</a></li>
                        <li><a href="#" class="text-muted">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h6>Connect With Us</h6>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-muted"><i class="bi bi-facebook fs-5"></i></a>
                        <a href="#" class="text-muted"><i class="bi bi-instagram fs-5"></i></a>
                        <a href="#" class="text-muted"><i class="bi bi-twitter fs-5"></i></a>
                    </div>
                </div>
            </div>
            <hr class="border-secondary">
            <p class="text-center text-muted mb-0">
                &copy; 2025 WorldBook - All rights reserved
            </p>
        </div>
    </footer>

    <!-- Chat AI nổi góc trái -->
    <div id="chatbot-container">
        <div id="chatbot-toggle">
            <i class="bi bi-robot"></i>
        </div>

        <div id="chatbot-box" class="shadow">
            <div id="chatbot-header">
                <strong>WorldBook Chat AI</strong>
                <span id="chatbot-close">&times;</span>
            </div>

            <div id="chatbot-messages"></div>

            <div id="chatbot-suggestions">
                <button class="chat-suggestion">Hôm nay có sách nào đang sale?</button>
                <button class="chat-suggestion">Sách nào vừa mới được ra mắt?</button>
                <button class="chat-suggestion">Cách đặt sách ở trang web?</button>
            </div>

            <div id="chatbot-input-area">
                <input type="text" id="chatbot-input" placeholder="Nhập câu hỏi..." />
                <button id="chatbot-send"><i class="bi bi-send"></i></button>
            </div>

            @if (User.Identity?.IsAuthenticated ?? false)
            {
                <div id="chatbot-footer">
                    <button id="contact-admin" class="btn btn-warning w-100 mt-2">
                        <i class="bi bi-person-lines-fill"></i> Liên hệ Admin
                    </button>
                </div>
            }
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    <script src="~/js/chatbot.js" asp-append-version="true"></script>
    <script src="~/js/search.js" asp-append-version="true"></script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>