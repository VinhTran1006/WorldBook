@model WorldBook.ViewModel.OrderDetailViewModel

@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Order Details";
}

<h2 class="mb-3">Order #@Model.OrderId</h2>

<div class="card shadow-sm rounded-3 p-4 mb-4">
    <h5>Customer Information</h5>
    <p><strong>Name:</strong> @Model.CustomerName</p>
    <p><strong>Email:</strong> @Model.Email</p>
    <p><strong>Phone:</strong> @Model.Phone</p>
    <p><strong>Address:</strong> @Model.Address</p>
</div>

<div class="card shadow-sm rounded-3 p-4 mb-4">
    <h5>Order Information</h5>
    <p>
        <strong>Status:</strong>
        @{
            string badgeClass = Model.Status switch
            {
                "Not Approved" => "secondary",
                "Preparing" => "warning",
                "Delivering" => "info",
                "Completed" => "success",
                "Cancelled" => "danger",
                _ => "dark"
            };
        }
        <span class="badge bg-@badgeClass px-3 py-2">@Model.Status</span>
    </p>
    <p><strong>Order Date:</strong> @Model.OrderDate?.ToString("dd/MM/yyyy")</p>
    <p><strong>Delivered Date:</strong> @Model.DeliveredDate?.ToString("dd/MM/yyyy")</p>
    <p><strong>Total Amount:</strong> @String.Format("{0:N0}", Model.TotalAmount) đ</p>
    <p><strong>Discount:</strong> @Model.Discount %</p>

    <!-- Hai nút hành động -->
    <div class="mt-3">
        @if (Model.Status != "Completed" && Model.Status != "Cancelled")
        {
            <form asp-action="ApproveOrderDetail" asp-controller="Order" method="post" asp-route-id="@Model.OrderId" class="d-inline">
                <button type="submit" class="btn btn-success me-2">
                    <i class="bi bi-check-circle"></i> Approve
                </button>
            </form>

            <form asp-action="CancelOrderDetai" asp-controller="Order" method="post" asp-route-id="@Model.OrderId" class="d-inline">
                <button type="submit" class="btn btn-danger">
                    <i class="bi bi-x-circle"></i> Cancel
                </button>
            </form>
        }
    </div>
</div>

<div class="card shadow-sm rounded-3 p-4 mb-4">
    <h5 class="fw-bold mb-3">
        <i class="bi bi-credit-card text-primary"></i> Payment Info
    </h5>

    <div class="ms-3">
        <p class="mb-2">
            <strong>Method:</strong>
            <span class="badge bg-info text-dark px-3 py-2">@Model.PaymentMethod</span>
        </p>

        <p class="mb-2">
            <strong>Status:</strong>
            <span class="badge bg-success px-3 py-2">@Model.PaymentStatus</span>
        </p>

        <p class="mb-0">
            <strong>Transaction ID:</strong>
            <code>@Model.TransactionId</code>
        </p>
    </div>
</div>

<div class="card shadow-sm rounded-3 p-4">
    <h5>Order Items</h5>
    <table class="table table-bordered align-middle">
        <thead class="table-light">
            <tr>
                <th class="text-center">Image</th>
                <th>Book</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.OrderItems)
            {
                <tr>
                    <td class="text-center">
                        @if (!string.IsNullOrEmpty(item.ImageUrl))
                        {
                            <img src="@item.ImageUrl" alt="@item.BookName" width="60" height="85" class="rounded border" style="object-fit: cover;" />
                        }
                        else
                        {
                            <span class="text-muted fst-italic">No image</span>
                        }
                    </td>
                    <td>@item.BookName</td>
                    <td>@item.Quantity</td>
                    <td>@String.Format("{0:N0}", item.UnitPrice) đ</td>
                    <td>@String.Format("{0:N0}", item.UnitPrice * item.Quantity) đ</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<a asp-controller="Order" asp-action="Index" class="btn btn-secondary mt-3">
    <i class="bi bi-arrow-left"></i> Back to Orders
</a>

<style>
    img.rounded.border {
        object-fit: cover;
        border: 1px solid #ddd;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .bg-info {
        background-color: #00c4ff !important;
    }

</style>
