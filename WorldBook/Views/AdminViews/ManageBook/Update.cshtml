@model WorldBook.ViewModel.BookEditViewModel;

@{
    ViewData["Title"] = "Edit Book";
}

<h2 class="mb-4">Edit Book</h2>

<!-- Validation tổng quát -->
<div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

<form id="editBookForm" asp-controller="Book" asp-action="Edit" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
    <input type="hidden" asp-for="BookId" />

    <div class="row mb-3">
        <div class="col-md-6">
            <label asp-for="BookName" class="form-label"></label>
            <input asp-for="BookName" class="form-control" />
            <span asp-validation-for="BookName" class="text-danger small"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="BookDescription" class="form-label"></label>
            <input asp-for="BookDescription" class="form-control" />
            <span asp-validation-for="BookDescription" class="text-danger small"></span>
        </div>
    </div>

    <div class="mb-3">
        <label asp-for="BookPrice" class="form-label"></label>
        <input asp-for="BookPrice" class="form-control" type="number" />
        <span asp-validation-for="BookPrice" class="text-danger small"></span>
    </div>

    <div class="mb-3">
        <label asp-for="BookQuantity" class="form-label"></label>
        <input asp-for="BookQuantity" class="form-control" type="number" />
        <span asp-validation-for="BookQuantity" class="text-danger small"></span>
    </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <label asp-for="PublisherName" class="form-label"></label>
            <input asp-for="PublisherName" class="form-control"  />
            <span asp-validation-for="PublisherName" class="text-danger small"></span>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label asp-for="SupplierName" class="form-label"></label>
                <input asp-for="SupplierName" class="form-control" />
                <span asp-validation-for="SupplierName" class="text-danger small"></span>
            </div>

            <div class="row g-3 mb-3">
                @for (int i = 1; i <= 4; i++)
                {
                    var previewId = $"previewImage{i}";
                    var inputId = $"fileInput{i}";
                    var name = $"ImageUrl{i}";

                    var currentImage = i switch
                    {
                        1 => Model.ExistingImageUrl1,
                        2 => Model.ExistingImageUrl2,
                        3 => Model.ExistingImageUrl3,
                        4 => Model.ExistingImageUrl4,
                        _ => null
                    };
                    var imageSrc = !string.IsNullOrEmpty(currentImage) ? currentImage : $"https://via.placeholder.com/200x150?text=Ảnh+{i}";
                    <div class="col-md-3 text-center">
                        <div style="width:100%;height:200px;border-radius:15px;overflow:hidden;background-color:#f8f9fa;
                        display:flex;justify-content:center;align-items:center;padding:10px;">
                            <label for="@inputId" style="width:100%;cursor:pointer;margin:0;display:block;">
                                <img id="@previewId"
                                     src="@imageSrc"
                                     style="width:100%;max-height:100%;object-fit:contain;border-radius:10px;"
                                     alt="Click để chọn ảnh" title="Click để chọn ảnh">
                            </label>
                            <input type="file" name="@name" id="@inputId" accept="image/*"
                                   style="display:none;" onchange="previewSelectedImage(this, '@previewId')">
                        </div>
                    </div>
                }
            </div>

   

    <div class="d-flex justify-content-end gap-2">
        <button type="submit" class="btn btn-success px-4">Save</button>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
   
}

<script>
         function previewSelectedImage(input, previewId) {
        const file = input.files[0];
        if (!file) return;
        if (!file.type.startsWith("image/")) {
            alert("Vui lòng chọn file ảnh hợp lệ!");
            input.value = "";
            return;
        }
        const reader = new FileReader();
        reader.onload = function (e) {
            document.getElementById(previewId).src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    $(document).ready(function () {
         // Thêm Author
         $("#authorList").on("click", ".add-author", function () {
             const newAuthorInput = `
                 <div class="input-group mb-2">
                     <input name="AuthorNames" class="form-control" placeholder="Tên tác giả..." />
                     <button type="button" class="btn btn-danger remove-author">
                         <i class="bi bi-dash"></i>
                     </button>
                 </div>`;
             $("#authorList").append(newAuthorInput);
         });

         $("#authorList").on("click", ".remove-author", function () {
             $(this).closest(".input-group").remove();
         });

         // Thêm Category
         $("#categoryList").on("click", ".add-category", function () {
             const newCategoryInput = `
                 <div class="input-group mb-2">
                     <input name="CategoryNames" class="form-control" placeholder="Tên thể loại..." />
                     <button type="button" class="btn btn-danger remove-category">
                         <i class="bi bi-dash"></i>
                     </button>
                 </div>`;
             $("#categoryList").append(newCategoryInput);
         });

         $("#categoryList").on("click", ".remove-category", function () {
             $(this).closest(".input-group").remove();
         });
     });
</script>


