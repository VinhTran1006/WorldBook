@model WorldBook.ViewModel.BookCreateEditViewModel

<div class="container mt-3 mb-3">
    <div class="card shadow-lg rounded-4">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0"><i class="bi bi-plus-circle"></i> Thêm Sách Mới</h3>
        </div>

        <div class="card-body p-4">
            <form id="bookForm" method="post" enctype="multipart/form-data" action="@Url.Action("Add", "Book")">
                <!-- Tên sách -->
                <div class="mb-3">
                    <label asp-for="BookName" class="form-label fw-bold"></label>
                    <input asp-for="BookName" class="form-control" placeholder="Nhập tên sách..." />
                    <span asp-validation-for="BookName" class="text-danger"></span>
                </div>

                <!-- Mô tả -->
                <div class="mb-3">
                    <label asp-for="BookDescription" class="form-label fw-bold"></label>
                    <textarea asp-for="BookDescription" class="form-control" rows="3" placeholder="Mô tả về sách..."></textarea>
                </div>

                <!-- Giá và số lượng -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label asp-for="BookPrice" class="form-label fw-bold"></label>
                        <input asp-for="BookPrice" class="form-control" type="number" step="0.01" placeholder="Giá sách..." />
                    </div>
                    <div class="col-md-6">
                        <label asp-for="BookQuantity" class="form-label fw-bold"></label>
                        <input asp-for="BookQuantity" class="form-control" type="number" placeholder="Số lượng..." />
                    </div>
                </div>

                <!-- Publisher & Supplier -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label asp-for="PublisherName" class="form-label fw-bold"></label>
                        <input asp-for="PublisherName" class="form-control" placeholder="Nhà xuất bản..." />
                    </div>
                    <div class="col-md-6">
                        <label asp-for="SupplierName" class="form-label fw-bold"></label>
                        <input asp-for="SupplierName" class="form-control" placeholder="Nhà cung cấp..." />
                    </div>
                </div>

                <hr class="my-4" />

                <!-- Tác giả -->
                <h5 class="fw-bold text-primary"><i class="bi bi-person-lines-fill"></i> Tác giả</h5>
                <div id="authorList" class="mb-3">
                    <div class="input-group mb-2">
                        <input name="AuthorNames" class="form-control" placeholder="Tên tác giả..." />
                        <button type="button" class="btn btn-success add-author"><i class="bi bi-plus"></i></button>
                    </div>
                </div>

                <!-- Thể loại -->
                <h5 class="fw-bold text-primary"><i class="bi bi-tags-fill"></i> Thể loại</h5>
                <div id="categoryList" class="mb-3">
                    <div class="input-group mb-2">
                        <input name="CategoryNames" class="form-control" placeholder="Tên thể loại..." />
                        <button type="button" class="btn btn-success add-category"><i class="bi bi-plus"></i></button>
                    </div>
                </div>

                <hr class="my-4" />

                <!-- Ảnh sách -->
                <div class="row g-3 mb-3">
                    @for (int i = 1; i <= 4; i++)
                    {
                        var previewId = $"previewImage{i}";
                        var inputId = $"fileInput{i}";
                        var name = $"ImageUrl{i}";
                        <div class="col-md-3 text-center">
                            <div style="width:100%;height:200px;border-radius:15px;overflow:hidden;background-color:#f8f9fa;
                            display:flex;justify-content:center;align-items:center;padding:10px;">
                                <label for="@inputId" style="width:100%;cursor:pointer;margin:0;display:block;">
                                    <img id="@previewId"
                                         src="https://via.placeholder.com/200x150?text=Ảnh+@i"
                                         style="width:100%;max-height:100%;object-fit:contain;border-radius:10px;"
                                         alt="Click để chọn ảnh" title="Click để chọn ảnh">
                                </label>
                                <input type="file" name="@name" id="@inputId" accept="image/*"
                                       style="display:none;" onchange="previewSelectedImage(this, '@previewId')">
                            </div>
                        </div>
                    }
                </div
                <div class="text-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i> Add
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function previewSelectedImage(input, previewId) {
        const file = input.files[0];
        if (!file) return;
        if (!file.type.startsWith("image/")) {
            alert("Vui lòng chọn file ảnh hợp lệ!");
            input.value = "";
            return;
        }
        const reader = new FileReader();
        reader.onload = function (e) {
            document.getElementById(previewId).src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    $(document).ready(function () {
         // Thêm Author
         $("#authorList").on("click", ".add-author", function () {
             const newAuthorInput = `
                 <div class="input-group mb-2">
                     <input name="AuthorNames" class="form-control" placeholder="Tên tác giả..." />
                     <button type="button" class="btn btn-danger remove-author">
                         <i class="bi bi-dash"></i>
                     </button>
                 </div>`;
             $("#authorList").append(newAuthorInput);
         });

         $("#authorList").on("click", ".remove-author", function () {
             $(this).closest(".input-group").remove();
         });

         // Thêm Category
         $("#categoryList").on("click", ".add-category", function () {
             const newCategoryInput = `
                 <div class="input-group mb-2">
                     <input name="CategoryNames" class="form-control" placeholder="Tên thể loại..." />
                     <button type="button" class="btn btn-danger remove-category">
                         <i class="bi bi-dash"></i>
                     </button>
                 </div>`;
             $("#categoryList").append(newCategoryInput);
         });

         $("#categoryList").on("click", ".remove-category", function () {
             $(this).closest(".input-group").remove();
         });
     });
</script>
